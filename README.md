# Linux
UNIX-системы, Linux:
# Практическое задание №1:

`Установка Linux Ubuntu 20.04.4 LTS x86_64`


# Практическое задание №2:

1. Просмотреть содержимое директорий /etc, /proc, /home. Посмотреть пару произвольных файлов в /etc.
```bash
cd /etc
ll
cat wgetrc
cd /proc
cd /home
```
2. Выяснить, для чего предназначена команда cat. Используя данную команду, создать два файла с данными, а затем объединить их. Просмотреть содержимое созданного файла. Переименовать файл, дав ему новое имя.
```bash
cat для просмотра содержимого файлов, для склейки файлов, для записи текста в файл.
```
3. Создать несколько файлов. Создать директорию, переместить файл туда. Удалить все созданные в этом и предыдущем задании директории и файлы.
```bash
nano file
mkdir dir
mv file /dir/
cd dir
rm file
```
4. В ОС Linux скрытыми файлами считаются те, имена которых начинаются с символа “.”. Сколько скрытых файлов в вашем домашнем каталоге? (Использовать конвейер. Подсказка: для подсчета количества строк можно использовать wc.)
```bash
ls -al | grep '.' | wc -l
ещё вариант: ls -lad .* | grep ^- | wc -l
Ответ: 18
```
5. Попробовать вывести с помощью cat содержимое всех файлов в директории /etc. Направить ошибки в отдельный файл в вашей домашней директории. Сколько файлов, которые не удалось посмотреть, оказалось в списке?
```bash
grep 'error' err.txt | wc -l
```
6. Запустить в одном терминале программу, а в другом терминале посмотреть PID процесса и остановить с помощью kill, посылая разные типы сигналов. Что происходит?
```bash
ps -afx
kill -9 "id ps -afx"
```
7. * Отобразить в /dev список устройств, которые в настоящее время используются вашим UID (для этого используется команда lsof). Организовать конвейер через less, чтобы посмотреть их должным образом.
```bash
lsof -u 1000 -a +D /dev | less
```
8. * Полезное задание на конвейер. Использовать команду cut на вывод длинного списка каталога, чтобы отобразить только права доступа к файлам. Затем отправить в конвейере этот вывод на sort и uniq, чтобы отфильтровать все повторяющиеся строки. Потом с помощью wc подсчитать различные типы разрешений в этом каталоге. Самостоятельно решить задачу, как сделать так, чтобы в подсчет не добавлялись строка «Итого» и файлы . и .. (ссылки на текущую и родительскую директории).
```bash
ls -lA ~/ | grep -v 'total' | cut -d " " -f '1' | sort | uniq | wc -l
```


# Практическое задание №3:

1. Создать файл file1 и наполнить его произвольным содержимым. Скопировать его в file2. Создать символическую ссылку file3 на file1. Создать жесткую ссылку file4 на file1. Посмотреть, какие айноды у файлов. Удалить file1. Что стало с остальными созданными файлами? Попробовать вывести их на экран.
```bash
cat > file1
cp file1 file2
ln -s file1 file3
ln file1 file4
ls -ali (проверяем)
410583 lrwxrwxrwx 1 andrey andrey     5 May 28 23:21 file3 -> file1
410581 -rw-rw-r-- 1 andrey andrey    16 May 28 23:20 file4
cat file3 - не выводится
cat file4 - выводит содержимое
```
2. Дать созданным файлам другие, произвольные имена. Создать новую символическую ссылку. Переместить ссылки в другую директорию.
```bash
mv file2 file2_new
mv file3 file3_new
mv file4 file4_new
ln -s file2 file5
ln -s file1 file3_new
mkdir ln_2
mv file5 ln_2
cd ln_2
ls -ali - красным показывает file5 -> file2
```
3. Создать два произвольных файла. Первому присвоить права на чтение, запись для владельца и группы, только на чтение — для всех. Второму присвоить права на чтение, запись — только для владельца. Сделать это в численном и символьном виде.
```bash
touch file{1..2}
chmod 664 file1
chmod 600 file2
chmod u-rwx,g-rwx,o-rwx file1 file2
chmod u+rw,g+rw,o+r file1
chmod u+rw file2
ls -ali
```
4. Создать пользователя, обладающего возможностью выполнять действия от имени суперпользователя.
```bash
sudo adduser testuser
full name: testuser
sudo usermod -aG sudo testuser
su testuser
sudo whoami
```
5. * Создать группу developer и несколько пользователей, входящих в нее. Создать директорию для совместной работы. Сделать так, чтобы созданные одними пользователями файлы могли изменять другие пользователи этой группы.
```bash
sudo chgrp adm test2
sudo chmod g+s test2
```   
6. * Создать в директории для совместной работы поддиректорию для обмена файлами, но чтобы удалять файлы могли только их создатели.
```bash
sudo chmod +t subdir
```
7. * Создать директорию, в которой есть несколько файлов. Сделать так, чтобы открыть файлы можно было, только зная имя файла, а через ls список файлов посмотреть было нельзя.
```bash
sudo chmod a-r test2
cat test2/testf2
```


# Практическое задание №4:

1. Написать скрипт, который удаляет из текстового файла пустые строки и заменяет маленькие символы на большие (воспользуйтесь tr или sed).
```bash
sed '/^$/d' bashsc.txt
tr -s '\n' < bashsc.txt
```
2. Создать скрипт, который создаст директории для нескольких годов (2010 — 2017), в них — поддиректории для месяцев (от 01 до 12), и в каждый из них запишет несколько файлов с произвольными записями (например, 001.txt, содержащий текст«Файл 001», 002.txt с текстом Файл 002) и т. д.
```bash
#!/bin/bash

for pf in ./task2/{2010..2020}/{01..12}/{001..005}; do
  mkdir -p "$(dirname $pf)" && echo "Файл $(echo $pf | cut -d '/' -f 5)" > "$pf.txt"
done
```


# Практическое задание №5:

1. Произвести ручную настройку сети в Ubuntu через команду ip и систему netplan.
```bash
cd /etc
cd netplan
cat 00-installer-config.yaml (смотрим конфиги)
sudo nano 00-installer-config.yaml (редактируем)
```
```ruby
network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
    dhcp4: yes
    nameservers:
      addresses:
        - 8.8.8.8
        - 8.8.4.4
```
Второй вариант:
```ruby
network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
    dhcp4: no
	addresses: [192.168.0.56/24, 192.168.0.8/24]
    routes:
	  - to: default
	    via: 192.168.0.254
	nameservers:
      addresses:
        - 8.8.8.8
        - 8.8.4.4
```
Проверяем на наличие ошибок:
```bash
sudo netplan generate
```

2. Переключить настройку сети на автоматическую через DHCP, проверить получение адреса.
```bash
cd /etc/netplan
nano 00-installer-config.yaml
```
```ruby
network:
    version: 2
    renderer: networkd
    ethernets:
        enp3s0:
            dhcp4: true


network:
    version: 2
    renderer: networkd
    ethernets:
        enp3s0:
            addresses:
                - 10.10.10.2/24
            nameservers:
                search: [mydomain, otherdomain]
                addresses: [10.10.10.1, 1.1.1.1]
            routes:
                - to: default
                  via: 10.10.10.1
```

3. Изменить адрес DNS на 1.1.1.1 и проверить доступность интернета, например, открыв любой браузер на адрес https://geekbrains.ru.
```ruby
network:
  version: 2
  renderer: networkd
  ethernets:
    enp3s0:
      dhcp4: no
      addresses: [192.168.0.108/24]
	  routes:
	   - to: default
	     via: 192.168.0.1
	  mtu: 1500
	  nameservers:
      addresses: [1.1.1.1, 8.8.8.8]
```


# Практическое задание №6:

1. Настроил виртуальный сервер в облаке (GCP, AWS, VDS и др.) с публичным IP-адресом
2. Установил веб-сервер Nginx и подключился к нему
3. Настроил фаервол, чтобы был доступ только к сервисам http и ssh.


# Практическое задание №8:

1. Настроить сетевой фильтр, чтобы из внешней сети можно было обратиться только к сервисам http и ssh (80 и 443).
```bash
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
```
2. Запросы, идущие на порт 8080, перенаправлять на порт 80.
```bash
iptables -t filter -A INPUT -p tcp --sport 80 -j ACCEPT.
iptables -t filter -A INPUT -p tcp --sport 443 -j ACCEPT.
iptables -t nat -A PREROUTING -p tcp --sport 8080 --dport 80 -j REDIRECT
```
3. Настроить доступ по ssh только для вашего IP-адреса (или из всей сети вашего провайдера).
```bash
iptables -A INPUT -s 127.0.0.1 -p tcp --dport 22 -j accept
iptables -A INPUT -p tcp --dport 22 -j DROP
```

## Настроил правила iptables, чтобы из внешней сети можно было обратиться только к портам 80 и 443. Запросы на порт 8080 перенаправлять на порт 80. iptables -t filter -A INPUT -p tcp --sport 80 -j ACCEPT. iptables -t filter -A INPUT -p tcp --sport 443 -j ACCEPT. iptables -t nat -A PREROUTING -p tcp --sport 8080 --dport 80 -j REDIRECT.
